<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Shirt Order Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="text"], input[type="tel"], select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus, input[type="tel"]:focus, select:focus {
            border-color: #007bff;
            outline: none;
        }
        
        .sizes-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .sizes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .size-group {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .size-group h4 {
            margin: 0 0 10px 0;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .size-input {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .size-input label {
            margin: 0;
            font-weight: normal;
            flex: 1;
        }
        
        .size-input input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .submit-btn {
            background-color: #28a745;
            color: white;
        }
        
        .submit-btn:hover {
            background-color: #218838;
        }
        
        .clear-btn {
            background-color: #6c757d;
            color: white;
        }
        
        .clear-btn:hover {
            background-color: #545b62;
        }
        
        .export-btn {
            background-color: #007bff;
            color: white;
        }
        
        .export-btn:hover {
            background-color: #0056b3;
        }
        
        .orders-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .orders-table th, .orders-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        .orders-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .orders-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .no-orders {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background-color: #c82333;
        }
        
        .total-quantity {
            font-weight: bold;
            color: #007bff;
            margin-top: 10px;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>T-Shirt Order Form</h1>
        
        <div id="orderForm">
            <div class="form-group">
                <label for="name">Name *</label>
                <input type="text" id="name" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="phone">Phone Number *</label>
                <input type="tel" id="phone" name="phone" required placeholder="(555) 123-4567">
            </div>
            
            <div class="form-group">
                <label for="color">Shirt Color *</label>
                <select id="color" name="color" required>
                    <option value="">Select a color</option>
                    <option value="Military Green">Military Green</option>
                    <option value="Banana Cream">Banana Cream</option>
                </select>
            </div>
            
            <div class="sizes-section">
                <label>Select Quantities by Size *</label>
                <div class="sizes-grid">
                    <div class="size-group">
                        <h4>Adult Sizes</h4>
                        <div class="size-input">
                            <label>Small:</label>
                            <input type="number" name="adult_small" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>Medium:</label>
                            <input type="number" name="adult_medium" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>Large:</label>
                            <input type="number" name="adult_large" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>XL:</label>
                            <input type="number" name="adult_xl" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>2XL:</label>
                            <input type="number" name="adult_2xl" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>3XL:</label>
                            <input type="number" name="adult_3xl" min="0" max="999" value="0">
                        </div>
                    </div>
                    
                    <div class="size-group">
                        <h4>Youth Sizes</h4>
                        <div class="size-input">
                            <label>XS:</label>
                            <input type="number" name="youth_xs" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>Small:</label>
                            <input type="number" name="youth_small" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>Medium:</label>
                            <input type="number" name="youth_medium" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>Large:</label>
                            <input type="number" name="youth_large" min="0" max="999" value="0">
                        </div>
                        <div class="size-input">
                            <label>XL:</label>
                            <input type="number" name="youth_xl" min="0" max="999" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="total-quantity" id="totalQuantity">Total Items: 0</div>
                <div class="error-message" id="quantityError" style="display: none;">
                    Please select at least one item.
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" class="submit-btn" onclick="submitOrder()">Add Order</button>
                <button type="button" class="clear-btn" onclick="clearForm()">Clear Form</button>
                <button type="button" class="export-btn" onclick="exportToCSV()">Export to CSV</button>
            </div>
        </div>
        
        <div class="orders-section">
            <h2>Current Orders (<span id="orderCount">0</span>)</h2>
            <div id="ordersContainer">
                <div class="no-orders">No orders yet. Add your first order above!</div>
            </div>
        </div>
    </div>

    <script>
        let orders = [];
        let orderIdCounter = 1;

        // Google Sheets Web App URL - Connected and ready!
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbxl_Qc23_1BDyIeEBOF4nINP_h3wIUlSPa7OyYnEuaPHJVPmw_ntMgyPWaeOtsApZ2w/exec';

        // Update total quantity when any quantity input changes
        document.addEventListener('input', function(e) {
            if (e.target.type === 'number') {
                updateTotalQuantity();
            }
        });

        function updateTotalQuantity() {
            const quantityInputs = document.querySelectorAll('input[type="number"]');
            let total = 0;
            
            quantityInputs.forEach(input => {
                total += parseInt(input.value) || 0;
            });
            
            document.getElementById('totalQuantity').textContent = `Total Items: ${total}`;
        }

        function submitOrder() {
            console.log('Submit button clicked!');
            
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const color = document.getElementById('color').value;
            const errorElement = document.getElementById('quantityError');
            const submitBtn = document.querySelector('.submit-btn');
            
            // Validate required fields
            if (!name || !phone || !color) {
                alert('Please fill in all required fields (Name, Phone, and Color).');
                return;
            }
            
            // Collect all quantities
            const quantities = {};
            let totalQuantity = 0;
            
            const sizeFields = [
                'adult_small', 'adult_medium', 'adult_large', 'adult_xl', 'adult_2xl', 'adult_3xl',
                'youth_xs', 'youth_small', 'youth_medium', 'youth_large', 'youth_xl'
            ];
            
            sizeFields.forEach(field => {
                const input = document.querySelector(`input[name="${field}"]`);
                const qty = parseInt(input.value) || 0;
                if (qty > 0) {
                    quantities[field] = qty;
                    totalQuantity += qty;
                }
            });
            
            console.log('Total quantity:', totalQuantity);
            
            // Validate that at least one item is selected
            if (totalQuantity === 0) {
                console.log('No items selected - showing error');
                errorElement.style.display = 'block';
                errorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            errorElement.style.display = 'none';
            console.log('Validation passed, creating order...');
            
            // Disable submit button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            const order = {
                id: orderIdCounter++,
                name: name,
                phone: phone,
                color: color,
                quantities: quantities,
                totalQuantity: totalQuantity,
                timestamp: new Date().toLocaleString()
            };
            
            console.log('Created order object:', order);
            
            // Process the order
            try {
                orders.push(order);
                updateOrdersDisplay();
                clearForm();
                
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Order';
                
                // Show thank you message
                alert('Thank you for your order! Your order has been received.');
                console.log('Order processed successfully');
                
                // Also try to send to Google Sheets in the background
                sendToGoogleSheetsBackground(order);
                
            } catch (error) {
                console.error('Error processing order:', error);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Order';
                alert('There was an error processing your order. Please try again.');
            }
        }

        async function sendToGoogleSheetsBackground(order) {
            try {
                console.log('Attempting to send order to Google Sheets in background:', order);
                
                // Prepare data for Google Sheets
                const sheetData = {
                    name: order.name,
                    phone: order.phone,
                    color: order.color,
                    adult_small: order.quantities.adult_small || 0,
                    adult_medium: order.quantities.adult_medium || 0,
                    adult_large: order.quantities.adult_large || 0,
                    adult_xl: order.quantities.adult_xl || 0,
                    adult_2xl: order.quantities.adult_2xl || 0,
                    adult_3xl: order.quantities.adult_3xl || 0,
                    youth_xs: order.quantities.youth_xs || 0,
                    youth_small: order.quantities.youth_small || 0,
                    youth_medium: order.quantities.youth_medium || 0,
                    youth_large: order.quantities.youth_large || 0,
                    youth_xl: order.quantities.youth_xl || 0,
                    total_quantity: order.totalQuantity,
                    timestamp: order.timestamp
                };

                console.log('Sending data to Google Sheets:', sheetData);
                console.log('Google Sheets URL:', GOOGLE_SHEETS_URL);

                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sheetData)
                });

                console.log('Response received from Google Sheets (no-cors mode)');

            } catch (error) {
                console.error('Error submitting to Google Sheets:', error);
            }
        }

        function updateOrdersDisplay() {
            const container = document.getElementById('ordersContainer');
            const countElement = document.getElementById('orderCount');
            
            countElement.textContent = orders.length;
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="no-orders">No orders yet. Add your first order above!</div>';
                return;
            }
            
            let tableHTML = `
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Color</th>
                            <th>Sizes & Quantities</th>
                            <th>Total</th>
                            <th>Date Added</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            orders.forEach((order, index) => {
                let sizesText = '';
                const sizeLabels = {
                    'adult_small': 'Adult S',
                    'adult_medium': 'Adult M',
                    'adult_large': 'Adult L',
                    'adult_xl': 'Adult XL',
                    'adult_2xl': 'Adult 2XL',
                    'adult_3xl': 'Adult 3XL',
                    'youth_xs': 'Youth XS',
                    'youth_small': 'Youth S',
                    'youth_medium': 'Youth M',
                    'youth_large': 'Youth L',
                    'youth_xl': 'Youth XL'
                };
                
                Object.entries(order.quantities).forEach(([size, qty]) => {
                    if (qty > 0) {
                        sizesText += `${sizeLabels[size]}: ${qty}<br>`;
                    }
                });
                
                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${order.name}</td>
                        <td>${order.phone}</td>
                        <td>${order.color}</td>
                        <td>${sizesText}</td>
                        <td><strong>${order.totalQuantity}</strong></td>
                        <td>${order.timestamp}</td>
                        <td><button class="delete-btn" onclick="deleteOrder(${order.id})">Delete</button></td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        function clearForm() {
            document.getElementById('name').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('color').value = '';
            
            // Clear all quantity inputs
            const quantityInputs = document.querySelectorAll('input[type="number"]');
            quantityInputs.forEach(input => {
                input.value = '0';
            });
            
            updateTotalQuantity();
        }

        function deleteOrder(orderId) {
            if (confirm('Are you sure you want to delete this order?')) {
                orders = orders.filter(order => order.id !== orderId);
                updateOrdersDisplay();
            }
        }

        function exportToCSV() {
            if (orders.length === 0) {
                alert('No orders to export!');
                return;
            }
            
            let csv = 'Name,Phone Number,Shirt Color,Adult S,Adult M,Adult L,Adult XL,Adult 2XL,Adult 3XL,Youth XS,Youth S,Youth M,Youth L,Youth XL,Total Quantity,Date Added\n';
            
            orders.forEach(order => {
                const sizeLabels = ['adult_small', 'adult_medium', 'adult_large', 'adult_xl', 'adult_2xl', 'adult_3xl', 'youth_xs', 'youth_small', 'youth_medium', 'youth_large', 'youth_xl'];
                
                let row = `"${order.name}","${order.phone}","${order.color}"`;
                
                sizeLabels.forEach(size => {
                    row += `,${order.quantities[size] || 0}`;
                });
                
                row += `,${order.totalQuantity},"${order.timestamp}"\n`;
                csv += row;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tshirt_orders.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize total quantity display
        updateTotalQuantity();
    </script>
</body>
</html>